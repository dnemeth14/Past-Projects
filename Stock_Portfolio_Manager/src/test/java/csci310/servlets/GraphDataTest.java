package csci310.servlets;

import csci310.Stocks.Stocks;
import csci310.User;
import csci310.utilities.FinnhubHistory;
import csci310.utilities.Resolution;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.Mockito;
import org.powermock.api.mockito.PowerMockito;
import org.powermock.core.classloader.annotations.PowerMockIgnore;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.PrintWriter;
import java.io.StringWriter;
import java.sql.SQLException;
import org.json.simple.parser.ParseException;
import java.util.ArrayList;
import java.util.List;

@PrepareForTest({Stocks.class, FinnhubHistory.class, User.class})
@PowerMockIgnore("javax.net.ssl.*")
@RunWith(PowerMockRunner.class)
public class GraphDataTest extends Mockito {
    public static String expectedAAPL = "{\"c\":[75.089996337891,74.360000610352,74.949996948242,74.599998474121,75.800003051758,77.410003662109,77.580001831055,79.23999786377,78.169998168945,77.830001831055,78.809997558594,79.680000305176,79.139999389648,79.419998168945,79.809997558594,79.580001831055,77.23999786377,79.419998168945,81.080001831055,80.970001220703,77.379997253418,77.169998168945,79.709999084473,80.360000610352,81.300003051758,80.01000213623,80.389999389648,79.900001525879,81.800003051758,81.220001220703,81.23999786377,79.75,80.910003662109,80.080001831055,78.26000213623,74.550003051758,72.019996643066,73.160003662109,68.379997253418,68.339996337891,74.699996948242,72.330001831055,75.690002441406,73.230003356934,72.26000213623,66.540000915527,71.330001831055,68.860000610352,62.060001373291,69.48999786377,60.549999237061,63.220001220703,61.669998168945,61.200000762939,57.310001373291,56.090000152588,61.720001220703,61.380001068115,64.610000610352,61.939998626709,63.700000762939,63.569999694824,60.229999542236,61.229999542236,60.349998474121,65.620002746582,64.860000610352,66.519996643066,67,68.309997558594,71.76000213623,71.110000610352,71.669998168945,70.699996948242,69.230003356934,67.089996337891,69.029998779297,68.76000213623,70.73999786377,70.790000915527,69.639999389648,71.930000305176,73.449996948242,72.269996643066,73.290000915527,74.389999389648,75.160003662109,75.940002441406,77.529998779297,78.75,77.849998474121,76.910003662109,77.389999389648,76.930000305176,78.73999786377,78.279998779297,79.809997558594,79.209999084473,79.720001220703,79.180000305176,79.529998779297,79.559997558594,79.480003356934,80.459999084473,80.830001831055,81.279998779297,80.580001831055,82.879997253418,83.360000610352,86,88.209999084473,83.970001220703,84.699996948242,85.75,88.019996643066,87.900001525879,87.930000305176,87.430000305176,89.720001220703,91.629997253418,90.019996643066,91.209999084473,88.410003662109,90.440002441406,91.199996948242,91.029998779297,91.029998779297,93.459999084473,93.169998168945,95.339996337891,95.680000305176,95.919998168945,95.480003356934,97.059997558594,97.720001220703,96.519996643066,96.330001831055,98.360000610352,97,97.269996643066,92.839996337891,92.610000610352,94.809997558594,93.25,95.040000915527,96.190002441406,106.26000213623,108.94000244141,109.66999816895,110.05999755859,113.90000152588,111.11000061035,112.73000335693,109.37999725342,113.01000213623,115.01000213623,114.91000366211,114.61000061035,115.55999755859,115.70999908447,118.2799987793,124.37000274658,125.86000061035,124.83000183105,126.51999664307,125.01000213623,124.80999755859,129.03999328613,134.17999267578,131.39999389648,120.87999725342,120.95999908447,112.81999969482,117.31999969482,113.48999786377,112,115.36000061035,115.54000091553,112.12999725342,110.33999633789,106.83999633789,110.08000183105,111.80999755859,107.12000274658,108.2200012207,112.2799987793,114.95999908447,114.08999633789,115.80999755859,116.79000091553,113.01999664307],\"h\":[75.150001525879,75.139999389648,74.98999786377,75.220001220703,76.110000610352,77.610000610352,78.169998168945,79.269996643066,79.389999389648,78.879997253418,78.919998168945,79.690002441406,79.75,80,79.889999389648,80.830001831055,77.940002441406,79.599998474121,81.959999084473,81.019996643066,80.669998168945,78.370002746582,79.910003662109,81.190002441406,81.309997558594,80.849998474121,80.389999389648,80.970001220703,81.809997558594,81.559997558594,81.5,79.940002441406,81.139999389648,81.160003662109,80.110000610352,76.050003051758,75.629997253418,74.470001220703,71.5,69.599998474121,75.360000610352,76,75.849998474121,74.889999389648,72.699996948242,69.519996643066,71.610000610352,70.309997558594,67.5,69.980003356934,64.769996643066,64.400001525879,62.5,63.209999084473,62.959999084473,57.119998931885,61.919998168945,64.559997558594,64.669998168945,63.970001220703,63.880001068115,65.620002746582,62.180000305176,61.290000915527,61.419998168945,65.779998779297,67.919998168945,66.839996337891,67.519996643066,68.419998168945,72.059997558594,71.580001831055,72.050003051758,71.73999786377,70.419998168945,69.309997558594,69.470001220703,70.440002441406,70.75,71.139999389648,71.459999084473,72.419998168945,73.629997253418,74.75,73.419998168945,75.25,75.809997558594,76.290000915527,77.589996337891,79.26000213623,79.919998168945,78.98999786377,77.449996948242,76.970001220703,79.120002746582,79.629997253418,79.879997253418,80.220001220703,79.809997558594,81.059997558594,79.680000305176,80.860000610352,80.290000915527,80.589996337891,80.860000610352,81.550003051758,81.410003662109,82.940002441406,83.400001525879,86.400001525879,88.690002441406,87.769996643066,86.949996948242,86.419998168945,88.300003051758,88.849998474121,88.360000610352,89.139999389648,89.860000610352,93.089996337891,92.199996948242,91.25,91.330001831055,90.540000915527,91.5,91.839996337891,92.620002746582,93.940002441406,94.660003662109,95.379997253418,96.319999694824,95.980003356934,99.949996948242,97.25,99.25,97.410003662109,97.150001525879,98.5,99.25,97.970001220703,97.080001831055,92.970001220703,94.910003662109,94.550003051758,95.230003356934,96.300003051758,106.41999816895,111.63999938965,110.79000091553,110.38999938965,114.41000366211,113.66999816895,113.7799987793,112.48000335693,113.2799987793,116.04000091553,115,116.08999633789,116,117.16000366211,118.38999938965,124.87000274658,128.7799987793,125.18000030518,126.98999786377,127.48000335693,126.44000244141,131,134.80000305176,137.97999572754,128.83999633789,123.69999694824,118.98999786377,119.13999938965,120.5,115.23000335693,115.93000030518,118.83000183105,116,112.19999694824,110.87999725342,110.19000244141,112.86000061035,112.11000061035,110.25,112.44000244141,115.31999969482,115.29000091553,117.23999786377,117.62999725342,115.37000274658],\"l\":[73.800003051758,74.120002746582,73.190002441406,74.370002746582,74.290000915527,76.550003051758,77.059997558594,77.790000915527,78.040000915527,77.389999389648,78.019996643066,78.75,79,79.330001831055,78.910003662109,79.379997253418,76.220001220703,78.050003051758,80.339996337891,79.690002441406,77.069999694824,75.559997558594,78.410003662109,79.73999786377,80.069999694824,79.5,78.459999084473,79.680000305176,80.370002746582,80.839996337891,80.709999084473,78.650001525879,80,79.550003051758,77.620002746582,72.309997558594,71.529998779297,71.620002746582,68.23999786377,64.089996337891,69.430000305176,71.449996948242,73.279998779297,72.849998474121,70.309997558594,65.75,67.339996337891,67.970001220703,62,63.240001678467,60,59.599998474121,59.279998779297,60.650001525879,57,53.150001525879,58.580001831055,61.080001831055,61.590000152588,61.759998321533,62.349998474121,63,59.779998779297,59.229999542236,59.740001678467,62.340000152588,64.75,65.309997558594,66.169998168945,66.459999084473,69.51000213623,70.160003662109,70.589996337891,69.220001220703,69.209999084473,66.360000610352,68.050003051758,68.720001220703,69.25,69.98999786377,69.550003051758,70.970001220703,72.089996337891,71.459999084473,71.580001831055,73.610000610352,74.720001220703,75.48999786377,76.069999694824,76.809997558594,77.730003356934,75.800003051758,75.379997253418,75.050003051758,77.580001831055,78.25,79.050003051758,78.970001220703,78.839996337891,79.120002746582,78.269996643066,78.910003662109,79.120002746582,79.300003051758,79.730003356934,80.580001831055,80.190002441406,80.809997558594,81.830001831055,83,86.519996643066,83.870002746582,83.559997558594,83.139999389648,86.180000305176,87.769996643066,87.309997558594,86.290000915527,87.790000915527,90.569999694824,89.629997253418,89.389999389648,88.25,87.819999694824,90,90.980003356934,90.910003662109,92.470001220703,93.059997558594,94.089996337891,94.669998168945,94.709999084473,95.26000213623,93.879997253418,96.48999786377,95.910003662109,95.839996337891,96.059997558594,96.73999786377,96.599998474121,92.01000213623,89.139999389648,93.480003356934,93.25,93.709999084473,93.769996643066,100.83000183105,107.88999938965,108.38999938965,108.90000152588,109.80000305176,110.29000091553,110,109.11000061035,110.30000305176,113.93000030518,113.05000305176,113.95999908447,114.01000213623,115.61000061035,115.73000335693,119.25,123.94000244141,123.05000305176,125.08000183105,123.83000183105,124.58000183105,126,130.5299987793,127,120.5,110.88999938965,112.68000030518,115.26000213623,112.5,110,112.80000305176,113.61000061035,112.04000091553,108.70999908447,106.08999633789,103.09999847412,109.16000366211,106.76999664307,105,107.66999816895,112.7799987793,113.61000061035,113.75,115.86000061035,112.2200012207],\"o\":[74.059997558594,74.290000915527,73.449996948242,74.959999084473,74.290000915527,76.809997558594,77.650001525879,77.910003662109,79.169998168945,77.959999084473,78.400001525879,79.069999694824,79.300003051758,79.639999389648,79.480003356934,80.059997558594,77.519996643066,78.150001525879,81.110000610352,80.139999389648,80.230003356934,76.080001831055,78.830001831055,80.879997253418,80.639999389648,80.589996337891,78.550003051758,80.900001525879,80.370002746582,81.050003051758,81.190002441406,78.839996337891,80,80.660003662109,79.660003662109,74.309997558594,75.23999786377,71.629997253418,70.279998779297,64.309997558594,70.569999694824,75.919998168945,74.110000610352,73.879997253418,70.5,65.940002441406,69.279998779297,69.349998474121,63.979999542236,66.220001220703,60.490001678467,61.880001068115,59.939998626709,61.849998474121,61.799999237061,57.020000457764,59.090000152588,62.689998626709,61.630001068115,63.189998626709,62.689998626709,63.900001525879,61.619998931885,60.090000152588,60.700000762939,62.729999542236,67.699996948242,65.690002441406,67.169998168945,67.080001831055,70,70.599998474121,71.839996337891,71.169998168945,69.48999786377,69.069999694824,68.400001525879,68.970001220703,69.300003051758,70.449996948242,71.269996643066,71.180000305176,72.48999786377,71.559997558594,72.290000915527,73.769996643066,75.110000610352,75.809997558594,76.410003662109,77.029998779297,79.459999084473,78.040000915527,76.129997253418,75.089996337891,78.290000915527,78.76000213623,79.169998168945,79.669998168945,78.940002441406,80.879997253418,79.029998779297,79.190002441406,79.809997558594,79.440002441406,80.190002441406,81.169998168945,81.099998474121,80.839996337891,82.559997558594,83.029998779297,86.970001220703,87.330001831055,86.180000305176,83.309997558594,87.860000610352,88.790000915527,87.849998474121,88.660003662109,87.830001831055,91,91.25,90.169998168945,91.099998474121,88.309997558594,90.019996643066,91.279998779297,91.959999084473,92.5,93.849998474121,94.180000305176,96.26000213623,95.330001831055,97.269996643066,94.839996337891,98.98999786377,96.559997558594,96.98999786377,96.419998168945,99.169998168945,96.690002441406,97,90.98999786377,93.709999084473,94.370002746582,93.75,94.190002441406,102.87999725342,108.19999694824,109.12999725342,109.37999725342,110.41000366211,113.19999694824,112.59999847412,111.9700012207,110.5,114.43000030518,114.83000183105,116.05999755859,114.34999847412,115.98000335693,115.75,119.26000213623,128.69999694824,124.69999694824,126.18000030518,127.13999938965,126.01000213623,127.58000183105,132.75999450684,137.58999633789,126.91000366211,120.06999969482,113.94999694824,117.26000213623,120.36000061035,114.56999969482,114.7200012207,118.33000183105,115.23000335693,109.7200012207,110.40000152588,104.54000091553,112.68000030518,111.62000274658,105.16999816895,108.43000030518,115.01000213623,114.54000091553,113.79000091553,117.62999725342,112.88999938965],\"s\":\"ok\",\"t\":[1577923200,1578009600,1578268800,1578355200,1578441600,1578528000,1578614400,1578873600,1578960000,1579046400,1579132800,1579219200,1579564800,1579651200,1579737600,1579824000,1580083200,1580169600,1580256000,1580342400,1580428800,1580688000,1580774400,1580860800,1580947200,1581033600,1581292800,1581379200,1581465600,1581552000,1581638400,1581984000,1582070400,1582156800,1582243200,1582502400,1582588800,1582675200,1582761600,1582848000,1583107200,1583193600,1583280000,1583366400,1583452800,1583712000,1583798400,1583884800,1583971200,1584057600,1584316800,1584403200,1584489600,1584576000,1584662400,1584921600,1585008000,1585094400,1585180800,1585267200,1585526400,1585612800,1585699200,1585785600,1585872000,1586131200,1586217600,1586304000,1586390400,1586736000,1586822400,1586908800,1586995200,1587081600,1587340800,1587427200,1587513600,1587600000,1587686400,1587945600,1588032000,1588118400,1588204800,1588291200,1588550400,1588636800,1588723200,1588809600,1588896000,1589155200,1589241600,1589328000,1589414400,1589500800,1589760000,1589846400,1589932800,1590019200,1590105600,1590451200,1590537600,1590624000,1590710400,1590969600,1591056000,1591142400,1591228800,1591315200,1591574400,1591660800,1591747200,1591833600,1591920000,1592179200,1592265600,1592352000,1592438400,1592524800,1592784000,1592870400,1592956800,1593043200,1593129600,1593388800,1593475200,1593561600,1593648000,1593993600,1594080000,1594166400,1594252800,1594339200,1594598400,1594684800,1594771200,1594857600,1594944000,1595203200,1595289600,1595376000,1595462400,1595548800,1595808000,1595894400,1595980800,1596067200,1596153600,1596412800,1596499200,1596585600,1596672000,1596758400,1597017600,1597104000,1597190400,1597276800,1597363200,1597622400,1597708800,1597795200,1597881600,1597968000,1598227200,1598313600,1598400000,1598486400,1598572800,1598832000,1598918400,1599004800,1599091200,1599177600,1599523200,1599609600,1599696000,1599782400,1600041600,1600128000,1600214400,1600300800,1600387200,1600646400,1600732800,1600819200,1600905600,1600992000,1601251200,1601337600,1601424000,1601510400,1601596800],\"v\":[135647456,146535520,118578576,111510624,132363784,170486176,140869088,122086888,162613824,121923528,108829016,137816464,110843256,101832464,104471968,146537520,161940016,162233952,216599712,126743232,199588384,173985600,136616544,118826872,105425536,117684048,109348864,94323120,113730288,94747568,80113792,152762176,93983968,100565952,129705664,222195312,230673456,198713728,320605536,426884928,341397344,319475392,219178272,187572880,226176992,286744832,285290080,256379872,418474080,370732128,322423456,324055872,300233632,271857024,401693376,336752832,287531104,303602048,252560672,204216608,167976448,197002000,176218560,165933968,129880064,201820288,202887328,168895280,162116496,131022928,194994688,131154560,157125152,215249920,130015000,180991568,117057368,124814328,126508736,117087568,112004752,137280816,183063872,240616704,133567944,147751184,142333760,115215056,134047936,145946240,162301056,200622560,158929072,166348384,135372496,101729536,111504864,102688848,81803016,125521816,112945096,133796416,153598128,81018608,87642816,104491216,87560368,137250208,95654536,147712368,166651744,201662448,200146048,138808928,165428736,114406504,96820384,264475808,135445264,212155472,192623392,137522512,205256848,130646080,140223280,110737232,114041472,118655648,112424456,117091880,125642608,90257320,191649136,170989360,153197936,110577672,92186896,90317904,103645840,89001648,197004432,185438864,121214192,103625504,90329256,158130016,374295456,308151392,172792368,121991952,202428896,198045616,212403424,187902368,165944816,210082064,165565216,119561440,105633536,145538016,126907184,338054656,345937760,211495792,163022272,155552384,187629920,225702688,152470144,200118992,257599648,332607168,231366560,176940448,182274384,180860320,140150080,184642032,155026672,178010976,287104896,195713808,183055376,150718672,167743344,149981440,137672400,100060528,142675184,116120440,144712000]}";
    public static String expectedGE = "{\"c\":[11.930000305176,11.970000267029,12.140000343323,12.050000190735,11.939999580383,11.909999847412,11.670000076294,12.119999885559,12.029999732971,11.869999885559,11.840000152588,11.810000419617,11.659999847412,11.369999885559,11.770000457764,11.710000038147,11.439999580383,11.729999542236,12.939999580383,12.729999542236,12.449999809265,12.260000228882,12.579999923706,12.859999656677,12.949999809265,12.829999923706,12.909999847412,12.85000038147,13.159999847412,12.939999580383,12.829999923706,12.75,12.609999656677,12.529999732971,12.25,11.859999656677,11.319999694824,10.949999809265,10.390000343323,10.880000114441,11.210000038147,10.880000114441,10.949999809265,10.079999923706,9.3999996185303,8.210000038147,8.8500003814697,8.210000038147,7.2300000190735,7.8499999046326,6.6599998474121,7.0799999237061,6.5999999046326,6.4800000190735,6.5199999809265,6.1100001335144,7.0100002288818,7.5599999427795,8.1199998855591,7.6199998855591,7.8899998664856,7.9400000572205,7.039999961853,6.9000000953674,6.7300000190735,7.2300000190735,7.0300002098083,7.3000001907349,7.1399998664856,7.0199999809265,6.9299998283386,6.5,6.2399997711182,6.8400001525879,6.5100002288818,6.4800000190735,6.4299998283386,6.5199999809265,6.2600002288818,6.4299998283386,6.8000001907349,6.5799999237061,6.8000001907349,6.5,6.210000038147,6.1999998092651,5.9800000190735,6.1100001335144,6.289999961853,6.1900000572205,6,5.789999961853,5.6999998092651,5.4899997711182,6.2699999809265,6.210000038147,6.4200000762939,6.4800000190735,6.4099998474121,6.8000001907349,7.289999961853,6.7800002098083,6.5700001716614,6.7600002288818,7.0500001907349,7.3600001335144,7.7399997711182,7.8800001144409,8.460000038147,8.0200004577637,7.6100001335144,6.9499998092651,7.25,7.2399997711182,7.4699997901917,7.2399997711182,7.2800002098083,7.1500000953674,7.039999961853,7,6.5300002098083,6.6799998283386,6.4800000190735,6.8000001907349,6.8299999237061,6.7399997711182,6.8200001716614,7,6.7600002288818,6.8600001335144,6.5799999237061,6.6900000572205,6.6999998092651,6.8800001144409,7.1399998664856,7.0500001907349,7.0700001716614,6.8699998855591,7.039999961853,7.0599999427795,7.039999961853,6.8600001335144,6.710000038147,6.8899998664856,6.5900001525879,6.2600002288818,6.0700001716614,6.1100001335144,6.1399998664856,6.4000000953674,6.3299999237061,6.4000000953674,6.6700000762939,6.7300000190735,6.7199997901917,6.5999999046326,6.6599998474121,6.4699997901917,6.4400000572205,6.3800001144409,6.2699999809265,6.3099999427795,6.6300001144409,6.5900001525879,6.4800000190735,6.4800000190735,6.6100001335144,6.3400001525879,6.1900000572205,6.4400000572205,6.3200001716614,6.4200000762939,6.1399998664856,6.1599998474121,6,5.9499998092651,6.1500000953674,6.0999999046326,6.75,7.0500001907349,6.8800001144409,6.3499999046326,6.25,6.1100001335144,6.0599999427795,6.1100001335144,6.1999998092651,6.1199998855591,6.2300000190735,6.2399997711182,6.3899998664856],\"h\":[11.960000038147,12,12.210000038147,12.229999542236,12.050000190735,12.090000152588,11.909999847412,12.14999961853,12.189999580383,12.020000457764,11.979999542236,11.930000305176,11.800000190735,11.710000038147,11.85000038147,11.890000343323,11.590000152588,11.819999694824,13,12.989999771118,12.739999771118,12.680000305176,12.619999885559,12.859999656677,13,13.090000152588,12.970000267029,12.979999542236,13.260000228882,13.159999847412,13.060000419617,12.949999809265,12.939999580383,12.680000305176,12.460000038147,12.060000419617,12,11.539999961853,10.949999809265,11.189999580383,11.340000152588,11.380000114441,11.119999885559,10.729999542236,9.7600002288818,8.6599998474121,8.8500003814697,8.6599998474121,7.7800002098083,8.039999961853,7.1500000953674,7.3299999237061,6.7800002098083,6.9000000953674,7.0500001907349,6.6300001144409,7.0599999427795,8,8.289999961853,7.8699998855591,7.9400000572205,8.1800003051758,7.5500001907349,7.3899998664856,7.0500001907349,7.3000001907349,7.75,7.3800001144409,7.539999961853,7.1300001144409,7.2399997711182,6.7300000190735,6.539999961853,6.9400000572205,6.75,6.5799999237061,6.6399998664856,6.7399997711182,6.5999999046326,6.4699997901917,6.9200000762939,6.9000000953674,6.8200001716614,6.7399997711182,6.3099999427795,6.460000038147,6.25,6.2600002288818,6.3299999237061,6.25,6.2800002098083,6.0100002288818,5.9000000953674,5.6599998474121,6.4800000190735,6.3699998855591,6.460000038147,6.5500001907349,6.4800000190735,6.9400000572205,7.4200000762939,7.460000038147,6.7199997901917,6.8099999427795,7.1700000762939,7.4200000762939,7.75,8.5600004196167,8.5699996948242,8.210000038147,7.9800000190735,7.3499999046326,7.4299998283386,7.3499999046326,7.7399997711182,7.5300002098083,7.3200001716614,7.4400000572205,7.0999999046326,7.1199998855591,6.8699998855591,6.6900000572205,6.6500000953674,6.8000001907349,6.8699998855591,7.0100002288818,7.039999961853,7.0799999237061,6.8899998664856,6.8699998855591,6.8299999237061,6.7199997901917,6.8200001716614,6.8899998664856,7.210000038147,7.1799998283386,7.1500000953674,7.0599999427795,7.1399998664856,7.0900001525879,7.1199998855591,7.1100001335144,6.8499999046326,6.960000038147,7,6.5,6.289999961853,6.1900000572205,6.1999998092651,6.4000000953674,6.4200000762939,6.460000038147,6.6999998092651,7,6.8800001144409,6.7600002288818,6.7199997901917,6.6599998474121,6.5599999427795,6.5700001716614,6.3699998855591,6.3800001144409,6.6399998664856,6.6900000572205,6.6199998855591,6.6199998855591,6.6199998855591,6.6799998283386,6.4000000953674,6.4499998092651,6.6399998664856,6.5599999427795,6.3499999046326,6.1999998092651,6.1900000572205,6.0500001907349,6.1599998474121,6.210000038147,6.8099999427795,7.1799998283386,7.1399998664856,6.6399998664856,6.5700001716614,6.4200000762939,6.1799998283386,6.1700000762939,6.3099999427795,6.2300000190735,6.289999961853,6.289999961853,6.4000000953674],\"l\":[11.229999542236,11.529999732971,11.840000152588,11.920000076294,11.869999885559,11.829999923706,11.590000152588,11.680000305176,11.989999771118,11.829999923706,11.819999694824,11.760000228882,11.609999656677,11.35000038147,11.60000038147,11.619999885559,11.380000114441,11.470000267029,12.489999771118,12.5,12.340000152588,12.25,12.390000343323,12.569999694824,12.829999923706,12.810000419617,12.770000457764,12.779999732971,12.880000114441,12.89999961853,12.75,12.670000076294,12.590000152588,12.409999847412,12.220000267029,11.60000038147,11.180000305176,10.789999961853,10.310000419617,9.8599996566772,10.760000228882,10.670000076294,10.699999809265,9.9499998092651,9.1800003051758,8.1099996566772,8.1599998474121,8.1599998474121,6.8299999237061,7.1900000572205,6.6500000953674,6.3000001907349,5.9000000953674,6.1500000953674,6.4499998092651,6.0300002098083,6.4699997901917,6.9699997901917,7.5199999809265,7.539999961853,7.3499999046326,7.8150000572205,7,6.7699999809265,6.5799999237061,6.9400000572205,7,7.0599999427795,7.0900001525879,6.7600002288818,6.8400001525879,6.3499999046326,6.1999998092651,6.3400001525879,6.460000038147,6.3000001907349,6.4000000953674,6.4299998283386,6.25,6.3299999237061,6.5700001716614,6.5199999809265,6.4099998474121,6.4099998474121,6.1500000953674,6.1599998474121,5.9699997901917,6.0599999427795,6.1599998474121,6.1300001144409,6,5.4800000190735,5.4800000190735,5.4899997711182,5.7699999809265,6.0900001525879,6.3000001907349,6.3299999237061,6.2699999809265,6.789999961853,7.0900001525879,6.75,6.4400000572205,6.4899997711182,6.8699998855591,7.1799998283386,7.1700000762939,7.8299999237061,8.1199998855591,7.9099998474121,7.5199999809265,6.8600001335144,7.0799999237061,6.8600001335144,7.289999961853,7.1999998092651,7.0300002098083,7.0900001525879,6.960000038147,6.9699997901917,6.5199999809265,6.4299998283386,6.4499998092651,6.5,6.6700000762939,6.710000038147,6.8099999427795,6.8899998664856,6.75,6.7199997901917,6.5799999237061,6.5300002098083,6.6399998664856,6.5700001716614,7.0300002098083,7,6.9800000190735,6.8600001335144,6.9000000953674,6.9000000953674,6.9699997901917,6.8200001716614,6.6999998092651,6.6999998092651,6.5199999809265,6.2600002288818,6,6.0199999809265,6.0999999046326,6.1399998664856,6.2800002098083,6.25,6.3899998664856,6.6999998092651,6.5799999237061,6.585000038147,6.4699997901917,6.4499998092651,6.4200000762939,6.3600001335144,6.210000038147,6.2300000190735,6.3000001907349,6.4800000190735,6.4499998092651,6.460000038147,6.4699997901917,6.2600002288818,6.1500000953674,6.1700000762939,6.289999961853,6.2600002288818,6.1300001144409,6.0199999809265,6,5.9299998283386,5.960000038147,6.0199999809265,6.0599999427795,6.6700000762939,6.8699998855591,6.2399997711182,6.210000038147,6.1100001335144,6,6.0199999809265,6.1900000572205,6.0599999427795,6.1399998664856,6.1100001335144,6.0500001907349],\"o\":[11.229999542236,11.569999694824,11.840000152588,12.14999961853,11.989999771118,12.069999694824,11.840000152588,11.739999771118,12.159999847412,12.020000457764,11.939999580383,11.85000038147,11.739999771118,11.710000038147,11.729999542236,11.880000114441,11.449999809265,11.520000457764,12.569999694824,12.890000343323,12.680000305176,12.460000038147,12.489999771118,12.760000228882,12.939999580383,13.020000457764,12.840000152588,12.949999809265,12.949999809265,13.079999923706,12.970000267029,12.710000038147,12.699999809265,12.64999961853,12.449999809265,11.689999580383,11.970000267029,11.369999885559,10.619999885559,9.9499998092651,11.210000038147,11.25,11.060000419617,10.60000038147,9.7399997711182,8.329999923706,8.7799997329712,8.6199998855591,7.2300000190735,7.8000001907349,6.9899997711182,6.9099998474121,6.5199999809265,6.3899998664856,7.0100002288818,6.4499998092651,6.6300001144409,7.3600001335144,7.6700000762939,7.6100001335144,7.539999961853,7.8699998855591,7.5199999809265,7.0199999809265,7.0300002098083,7.0700001716614,7.6900000572205,7.1799998283386,7.4499998092651,7.1300001144409,7.0999999046326,6.7300000190735,6.4800000190735,6.4699997901917,6.6100001335144,6.3899998664856,6.5900001525879,6.460000038147,6.5900001525879,6.3800001144409,6.5700001716614,6.6799998283386,6.5599999427795,6.6700000762939,6.3000001907349,6.2800002098083,6.1999998092651,6.0599999427795,6.210000038147,6.2399997711182,6.2199997901917,6.0100002288818,5.6100001335144,5.6100001335144,5.7800002098083,6.25,6.3299999237061,6.4200000762939,6.4800000190735,6.789999961853,7.25,7.460000038147,6.5599999427795,6.5799999237061,6.8800001144409,7.25,7.3099999427795,8.4499998092651,8.1899995803833,8.0600004196167,7.9699997901917,7.0500001907349,7.3400001525879,6.9200000762939,7.7300000190735,7.5300002098083,7.0900001525879,7.4200000762939,7.0900001525879,7.0900001525879,6.8499999046326,6.5100002288818,6.6199998855591,6.5999999046326,6.6799998283386,6.9299998283386,6.8600001335144,6.9699997901917,6.8899998664856,6.8099999427795,6.8099999427795,6.539999961853,6.7800002098083,6.6399998664856,7.0900001525879,7.0100002288818,7.0599999427795,7.0100002288818,6.9200000762939,6.9699997901917,7.0500001907349,7.0199999809265,6.789999961853,6.6999998092651,6.9899997711182,6.5,6.25,6.1399998664856,6.0999999046326,6.1799998283386,6.3099999427795,6.289999961853,6.4000000953674,6.8699998855591,6.8800001144409,6.5900001525879,6.539999961853,6.6500000953674,6.4899997711182,6.4400000572205,6.3299999237061,6.25,6.3800001144409,6.6500000953674,6.6199998855591,6.5199999809265,6.5100002288818,6.5199999809265,6.2699999809265,6.1900000572205,6.4499998092651,6.4299998283386,6.3099999427795,6.1999998092651,6.1700000762939,6.039999961853,5.9800000190735,6.1700000762939,6.1199998855591,6.7199997901917,6.9200000762939,6.6199998855591,6.3800001144409,6.289999961853,6.0900001525879,6.0599999427795,6.25,6.210000038147,6.1399998664856,6.2699999809265,6.0500001907349],\"s\":\"ok\",\"t\":[1577923200,1578009600,1578268800,1578355200,1578441600,1578528000,1578614400,1578873600,1578960000,1579046400,1579132800,1579219200,1579564800,1579651200,1579737600,1579824000,1580083200,1580169600,1580256000,1580342400,1580428800,1580688000,1580774400,1580860800,1580947200,1581033600,1581292800,1581379200,1581465600,1581552000,1581638400,1581984000,1582070400,1582156800,1582243200,1582502400,1582588800,1582675200,1582761600,1582848000,1583107200,1583193600,1583280000,1583366400,1583452800,1583712000,1583798400,1583884800,1583971200,1584057600,1584316800,1584403200,1584489600,1584576000,1584662400,1584921600,1585008000,1585094400,1585180800,1585267200,1585526400,1585612800,1585699200,1585785600,1585872000,1586131200,1586217600,1586304000,1586390400,1586736000,1586822400,1586908800,1586995200,1587081600,1587340800,1587427200,1587513600,1587600000,1587686400,1587945600,1588032000,1588118400,1588204800,1588291200,1588550400,1588636800,1588723200,1588809600,1588896000,1589155200,1589241600,1589328000,1589414400,1589500800,1589760000,1589846400,1589932800,1590019200,1590105600,1590451200,1590537600,1590624000,1590710400,1590969600,1591056000,1591142400,1591228800,1591315200,1591574400,1591660800,1591747200,1591833600,1591920000,1592179200,1592265600,1592352000,1592438400,1592524800,1592784000,1592870400,1592956800,1593043200,1593129600,1593388800,1593475200,1593561600,1593648000,1593993600,1594080000,1594166400,1594252800,1594339200,1594598400,1594684800,1594771200,1594857600,1594944000,1595203200,1595289600,1595376000,1595462400,1595548800,1595808000,1595894400,1595980800,1596067200,1596153600,1596412800,1596499200,1596585600,1596672000,1596758400,1597017600,1597104000,1597190400,1597276800,1597363200,1597622400,1597708800,1597795200,1597881600,1597968000,1598227200,1598313600,1598400000,1598486400,1598572800,1598832000,1598918400,1599004800,1599091200,1599177600,1599523200,1599609600,1599696000,1599782400,1600041600,1600128000,1600214400,1600300800,1600387200,1600646400,1600732800,1600819200,1600905600,1600992000,1601251200,1601337600,1601424000,1601510400,1601596800],\"v\":[87533904,85917200,111971000,71056000,55473000,39388000,58672000,66210000,45073000,46051000,36674000,46581000,43738000,61948000,73163000,59376000,47863000,62929000,220815008,95469000,77984000,50399000,44385000,50074000,63614000,66637000,33495000,40882000,65713000,51012000,36967000,44023000,54878000,39562000,42921000,70978000,81087000,93171000,94250000,151372992,124802000,109249000,83063000,108087000,148464000,122401000,98939000,103540000,157416000,110145000,115911000,120226000,138927008,98993744,126129000,105631000,119493832,137886464,123278592,93299016,86850000,121150000,99557000,97498000,97803000,98049000,96088000,92651000,128362000,94074000,107067000,138220992,165678000,165908000,99692000,77453000,76844000,82796000,155976992,107038000,140668992,225228000,175711008,120377000,136852000,116998000,117254000,100663000,93935000,71843000,95652000,235745312,140205424,128486208,255278688,108485064,91287376,98821120,69586000,128904000,147750912,138911504,129404000,75370408,113575392,122819504,125193928,167812000,158459072,117645232,116955000,124502904,100986000,102163752,98161392,75211296,78398240,88679536,78289648,80583904,144666032,73946584,89410000,75277304,69517120,120631000,74152000,75429400,62434000,64439248,74748008,63423000,68492432,69509216,89827128,52345288,60044000,49066000,69913920,65508264,68628512,65449000,70703976,76033648,148442000,127526920,142732000,89363000,71041752,106612744,69915672,83065000,94345024,93141504,70186472,52933000,50397000,59029424,42686044,54361952,63763960,59851000,102785416,69449104,57303984,73387920,59162000,141872960,92702000,83816608,94124920,89676000,120646032,108747000,97324840,71919000,74002056,86350792,258647168,261040288,145280992,162739632,140901040,88644744,95469752,79779000,83292808,74065792,96781552,79175600,90076000]}";
    JSONParser parser = new JSONParser();

    private JSONObject getJson(String apiResponse) throws org.json.simple.parser.ParseException {
        Object obj;
        obj = parser.parse(apiResponse);
        return (JSONObject)obj;
    }

    @Test
    public void testDoGet() throws Exception {
        List<String> userStocks = new ArrayList<>();
        userStocks.add("AAPL");
        userStocks.add("GE");
        List<String> badUserStocks = new ArrayList<>();
        badUserStocks.add("GOOGL");

        List<JSONObject> expectedApiResponses = new ArrayList<>();
        JSONObject expectedAAPLJson = null;
        JSONObject expectedGEJson = null;
        try {
            expectedAAPLJson = getJson(expectedAAPL);
            expectedGEJson = getJson(expectedGE);
            expectedApiResponses.add(expectedAAPLJson);
            expectedApiResponses.add(expectedGEJson);
        } catch (org.json.simple.parser.ParseException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }

        PowerMockito.mockStatic(Stocks.class);
        PowerMockito.when(Stocks.getUserStocks("-1")).thenThrow(SQLException.class);
        PowerMockito.when(Stocks.getUserStocks("3")).thenReturn(userStocks);
        PowerMockito.when(Stocks.getUserStocks("2")).thenReturn(badUserStocks);

        PowerMockito.mockStatic(FinnhubHistory.class);
        PowerMockito.when(FinnhubHistory.getHistories(eq(userStocks), any(Resolution.class), anyString(), anyString())).thenReturn(expectedApiResponses);
        PowerMockito.when(FinnhubHistory.getHistories(eq(badUserStocks), any(Resolution.class), anyString(), anyString())).thenThrow(ParseException.class);

        PowerMockito.mockStatic(User.class);
        PowerMockito.when(User.getIdByUsername(anyString())).thenReturn(-1);
        PowerMockito.when(User.getIdByUsername("trojan")).thenReturn(3);
        PowerMockito.when(User.getIdByUsername("two")).thenReturn(2);

        // passing test case
        String expectedPassResponse = "{\"datasets\":[{\"data\":[0,-0.7992526,0.8726542,-0.507784,1.2423112,1.7689226,-0.07843958,2.3095453,-1.2860352,-0.55740505,1.0479751,0.9181375,-0.7599061,-0.011016782,0.8626347,-0.31766996,-2.9431672,2.7098122,3.052553,-0.3415233,-4.308141,-0.44727036,3.098928,0.9976403,1.0928369,-1.5187377,0.49303222,-0.5929952,2.3273027,-0.8496209,-0.09567766,-1.697297,1.0906804,-0.98261917,-2.3201838,-4.744819,-3.6837142,0.915473,-6.7792363,0.5680345,7.7872224,-3.2447987,3.9589107,-3.997112,-2.0205748,-9.244152,6.7722626,-4.035293,-11.228169,10.408581,-15.072158,4.3954535,-2.9734972,-0.87174404,-6.031644,-2.6205804,9.500949,0.30461138,5.2110558,-4.557225,2.8356004,-0.11187502,-6.302967,1.2622937,-1.5652884,7.9203897,-1.3353828,2.6144679,0.43161544,1.5797092,4.2699304,-1.3915756,0.3850538,-0.47717667,-2.3765352,-2.9495797,2.5046375,-0.23910773,2.233768,0.28490186,-1.0204066,2.6366065,2.1682215,-1.8788923,0.91824317,1.3525207,0.6778539,1.109075,2.1116638,1.318581,-1.2999451,-1.3905609,0.46936068,-0.81290734,3.0466962,-0.6154535,2.0178568,-0.6301707,0.51085854,-0.17446095,0.9675148,-0.5559456,-0.33700556,1.3414334,0.75102824,0.8573946,-0.3623185,2.6884034,1.1544383,2.3399324,1.8785175,-5.389355,1.1201727,1.1184009,2.6180751,-0.3678773,0.07352137,-0.66609985,2.2529974,1.8959699,-2.1543262,1.3688875,-3.1615474,2.4166992,0.805869,-0.26593244,0.08175967,2.5980496,-0.53037006,2.2211318,0.058679037,0.34109586,-0.42082632,1.6932793,0.8773658,-1.2455354,-0.16440828,1.7390496,-1.1437932,0.27795774,-4.4553437,-0.4121806,2.0193021,-1.378068,1.4661078,0.80039006,8.795511,2.3641906,0.65624255,0.5581329,3.1356602,-2.3146975,1.582914,-2.8335207,3.0234716,1.5459232,-0.032897327,-0.40469566,0.75409687,0.07371312,1.9751098,4.6908574,1.3661389,-0.81418914,1.1879714,-1.148372,-0.053269915,2.9250937,3.5548947,-1.8354605,-8.364779,0.14130971,-7.0780077,3.6605093,-3.3391898,-1.3056388,2.9298043,0.10687047,-2.3216708,-1.2692715,-3.22723,2.3275845,1.3806516,-4.265649,0.9187919,3.4715776,2.2862303,-0.7902811,1.4995098,0.80468005,-3.0315745],\"label\":\"PORTFOLIO\"},{\"data\":[0,-0.9817048,0.7871866,-0.46916687,1.5831195,2.0798354,0.21912628,2.0948968,-1.3688111,-0.43684483,1.2434916,1.0918709,-0.6823363,0.3525545,0.48865983,-0.28901196,-3.0295236,2.744901,2.0473652,-0.13585354,-4.639447,-0.27212527,3.1865525,0.80886203,1.1562145,-1.6122994,0.47269222,-0.6132639,2.32274,-0.71411204,0.024614282,-1.868336,1.4336963,-1.0364658,-2.325581,-4.9765244,-3.5129223,1.558238,-6.9903574,-0.058532216,8.514057,-3.276642,4.4391603,-3.3592775,-1.3423765,-8.596334,6.715268,-3.58699,-10.957137,10.692182,-14.764654,4.22335,-2.5133827,-0.7679696,-6.787645,-2.175078,9.121842,-0.5539266,4.999225,-4.3106265,2.7629547,-0.20450065,-5.545409,1.6331862,-1.4581625,8.031094,-1.1717578,2.4954844,0.7164229,1.9177245,4.8076987,-0.91407895,0.7813556,-1.3719962,-2.1233475,-3.1897557,2.810376,-0.39266524,2.7989762,0.07063575,-1.651352,3.1836522,2.0694304,-1.6327665,1.3917372,1.4786913,1.0244868,1.027125,2.0508144,1.5492079,-1.1560714,-1.222201,0.62022966,-0.597945,2.2987015,-0.58763295,1.9170516,-0.7574782,0.6397418,-0.6819916,0.4400836,0.037705857,-0.10064695,1.2179912,0.45775422,0.553638,-0.8686981,2.7750912,0.57581973,3.0697668,2.5053837,-5.04942,0.86186045,1.2244934,2.5789557,-0.13651322,0.03411666,-0.57188606,2.5523863,2.084466,-1.7884921,1.3046842,-3.1670575,2.2445807,0.8333273,-0.1867496,0.0,2.600043,-0.31125998,2.2760627,0.35535532,0.2502063,-0.46082404,1.6278532,0.6754029,-1.2432705,-0.19723326,2.0638459,-1.4020624,0.27757442,-4.771651,-0.24834868,2.3204272,-1.6729196,1.8834184,1.195552,9.476755,2.46007,0.6656294,0.3543516,3.3713818,-2.511026,1.4370644,-3.062723,3.212109,1.7389791,-0.0870233,-0.2617599,0.82208115,0.12963575,2.17281,4.8966827,1.1838534,-0.82512116,1.3357531,-1.207899,-0.16024724,3.2780502,3.8306751,-2.1156766,-8.702843,0.06613908,-7.215032,3.8356633,-3.3747482,-1.3303553,2.912622,0.15579046,-3.0411162,-1.6222594,-3.2759268,2.9433188,1.547264,-4.3782625,1.0164466,3.615958,2.331246,-0.7625583,1.4851923,0.8391158,-3.335697],\"label\":\"AAPL\"},{\"data\":[0,0.33416843,1.4003301,-0.74688923,-0.9212782,-0.25188693,-2.0565531,3.71287,-0.748131,-1.3479347,-0.2533761,-0.25401974,-1.2864543,-2.5505714,3.3984754,-0.51238614,-2.360144,2.472293,9.35085,-1.6496469,-2.2489939,-1.5497519,2.5437179,2.1772919,0.6949819,-0.93530697,0.6196741,-0.46692187,2.3556192,-1.7001567,-0.85736287,-0.62745035,-1.1102327,-0.6384671,-2.285712,-3.2883673,-4.7703176,-3.3789945,-5.3897924,4.5036745,2.9437995,-3.0330875,0.6392666,-8.630952,-7.234046,-14.494513,7.2316422,-7.795376,-13.554634,7.898088,-17.867868,5.9322042,-7.272728,-1.85185,0.61349636,-6.710308,12.838803,7.2751284,6.896551,-6.5616803,3.422053,0.62972534,-12.784092,-2.0289834,-2.526004,6.91563,-2.8449473,3.6986299,-2.240901,-1.7094002,-1.2987036,-6.6153817,-4.1666703,8.771935,-5.0691233,-0.46296617,-0.777608,1.3803705,-4.1533504,2.6438508,5.4411817,-3.3434694,3.235298,-4.615388,-4.6698866,-0.16129403,-3.678926,2.1276615,2.8616824,-1.6155074,-3.1666677,-3.6269438,-1.5789502,-3.8251374,12.440195,-0.96618265,3.2710288,0.925925,-1.0920464,5.735299,6.7215333,-7.5221205,-3.1963475,2.8106515,4.1134744,4.2119555,4.9095564,1.7766541,6.855791,-5.4862785,-5.387652,-9.4964075,4.1379337,-0.1381247,3.078983,-3.176796,0.5494566,-1.8181834,-1.5625019,-0.571428,-7.197546,2.2455032,-3.0864167,4.7058845,0.43923473,-1.3353139,1.1730264,2.5714262,-3.5502923,1.4577246,-4.2553225,1.6442472,0.14925003,2.6162834,3.641453,-1.2765912,0.28288516,-2.9112122,2.4147737,0.28328586,-0.28409064,-2.6239042,-2.235471,2.6124794,-4.5523477,-5.271564,-3.1301491,0.65466386,0.488595,4.062504,-1.1058478,1.0937526,4.0479755,0.89152956,-0.14881293,-1.8181801,0.90090007,-2.9366317,-0.46583438,-0.940438,-1.754388,0.6339138,4.826548,-0.60697967,-1.6975329,0.0,1.9667188,-4.2586746,-2.4232647,3.8819876,-1.8987322,1.5576309,-4.560264,0.32467502,-2.6666641,-0.84033936,3.2520373,-0.81967527,9.629631,4.2553215,-2.4709313,-8.34646,-1.5999984,-2.2913234,-0.8250857,0.8183337,1.4516077,-1.3071884,1.7656522,0.16025244,2.3474195],\"label\":\"GE\"}],\"labels\":[\"1\\/2\",\"1\\/3\",\"1\\/6\",\"1\\/7\",\"1\\/8\",\"1\\/9\",\"1\\/10\",\"1\\/13\",\"1\\/14\",\"1\\/15\",\"1\\/16\",\"1\\/17\",\"1\\/21\",\"1\\/22\",\"1\\/23\",\"1\\/24\",\"1\\/27\",\"1\\/28\",\"1\\/29\",\"1\\/30\",\"1\\/31\",\"2\\/3\",\"2\\/4\",\"2\\/5\",\"2\\/6\",\"2\\/7\",\"2\\/10\",\"2\\/11\",\"2\\/12\",\"2\\/13\",\"2\\/14\",\"2\\/18\",\"2\\/19\",\"2\\/20\",\"2\\/21\",\"2\\/24\",\"2\\/25\",\"2\\/26\",\"2\\/27\",\"2\\/28\",\"3\\/2\",\"3\\/3\",\"3\\/4\",\"3\\/5\",\"3\\/6\",\"3\\/9\",\"3\\/10\",\"3\\/11\",\"3\\/12\",\"3\\/13\",\"3\\/16\",\"3\\/17\",\"3\\/18\",\"3\\/19\",\"3\\/20\",\"3\\/23\",\"3\\/24\",\"3\\/25\",\"3\\/26\",\"3\\/27\",\"3\\/30\",\"3\\/31\",\"4\\/1\",\"4\\/2\",\"4\\/3\",\"4\\/6\",\"4\\/7\",\"4\\/8\",\"4\\/9\",\"4\\/13\",\"4\\/14\",\"4\\/15\",\"4\\/16\",\"4\\/17\",\"4\\/20\",\"4\\/21\",\"4\\/22\",\"4\\/23\",\"4\\/24\",\"4\\/27\",\"4\\/28\",\"4\\/29\",\"4\\/30\",\"5\\/1\",\"5\\/4\",\"5\\/5\",\"5\\/6\",\"5\\/7\",\"5\\/8\",\"5\\/11\",\"5\\/12\",\"5\\/13\",\"5\\/14\",\"5\\/15\",\"5\\/18\",\"5\\/19\",\"5\\/20\",\"5\\/21\",\"5\\/22\",\"5\\/26\",\"5\\/27\",\"5\\/28\",\"5\\/29\",\"6\\/1\",\"6\\/2\",\"6\\/3\",\"6\\/4\",\"6\\/5\",\"6\\/8\",\"6\\/9\",\"6\\/10\",\"6\\/11\",\"6\\/12\",\"6\\/15\",\"6\\/16\",\"6\\/17\",\"6\\/18\",\"6\\/19\",\"6\\/22\",\"6\\/23\",\"6\\/24\",\"6\\/25\",\"6\\/26\",\"6\\/29\",\"6\\/30\",\"7\\/1\",\"7\\/2\",\"7\\/6\",\"7\\/7\",\"7\\/8\",\"7\\/9\",\"7\\/10\",\"7\\/13\",\"7\\/14\",\"7\\/15\",\"7\\/16\",\"7\\/17\",\"7\\/20\",\"7\\/21\",\"7\\/22\",\"7\\/23\",\"7\\/24\",\"7\\/27\",\"7\\/28\",\"7\\/29\",\"7\\/30\",\"7\\/31\",\"8\\/3\",\"8\\/4\",\"8\\/5\",\"8\\/6\",\"8\\/7\",\"8\\/10\",\"8\\/11\",\"8\\/12\",\"8\\/13\",\"8\\/14\",\"8\\/17\",\"8\\/18\",\"8\\/19\",\"8\\/20\",\"8\\/21\",\"8\\/24\",\"8\\/25\",\"8\\/26\",\"8\\/27\",\"8\\/28\",\"8\\/31\",\"9\\/1\",\"9\\/2\",\"9\\/3\",\"9\\/4\",\"9\\/8\",\"9\\/9\",\"9\\/10\",\"9\\/11\",\"9\\/14\",\"9\\/15\",\"9\\/16\",\"9\\/17\",\"9\\/18\",\"9\\/21\",\"9\\/22\",\"9\\/23\",\"9\\/24\",\"9\\/25\",\"9\\/28\",\"9\\/29\",\"9\\/30\",\"10\\/1\",\"10\\/2\"]}";
        HttpServletRequest requestPass = mock(HttpServletRequest.class);
        HttpServletResponse responsePass = mock(HttpServletResponse.class);
        when(requestPass.getParameter("username")).thenReturn("trojan");
        when(requestPass.getParameter("from")).thenReturn("1577836800");
        when(requestPass.getParameter("to")).thenReturn("1601849286");

        StringWriter stringWriter = new StringWriter();
        PrintWriter writer = new PrintWriter(stringWriter);
        when(responsePass.getWriter()).thenReturn(writer);

        GraphData gd = new GraphData();
        try {
            gd.doGet(requestPass, responsePass);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        writer.flush();
        Assert.assertEquals(expectedPassResponse, stringWriter.toString());

        // no user test case 400 response
        HttpServletRequest requestNoUser = mock(HttpServletRequest.class);
        HttpServletResponse responseNoUser = mock(HttpServletResponse.class);
        when(requestNoUser.getParameter("from")).thenReturn("1577836800");
        when(requestNoUser.getParameter("to")).thenReturn("1601849286");

        try {
            gd.doGet(requestNoUser, responseNoUser);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        verify(responseNoUser).sendError(400, "username is missing from url param");

        // no from test case 400 response
        HttpServletRequest requestNoFrom = mock(HttpServletRequest.class);
        HttpServletResponse responseNoFrom = mock(HttpServletResponse.class);
        when(requestNoFrom.getParameter("username")).thenReturn("1");
        when(requestNoFrom.getParameter("to")).thenReturn("1601849286");

        try {
            gd.doGet(requestNoFrom, responseNoFrom);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        verify(responseNoFrom).sendError(400, "from is missing from url param");

        // no to test case 400 response
        HttpServletRequest requestNoTo = mock(HttpServletRequest.class);
        HttpServletResponse responseNoTo = mock(HttpServletResponse.class);
        when(requestNoTo.getParameter("username")).thenReturn("1");
        when(requestNoTo.getParameter("from")).thenReturn("1577836800");

        try {
            gd.doGet(requestNoTo, responseNoTo);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        verify(responseNoTo).sendError(400, "to is missing from url param");

        // sql exception test case
        HttpServletRequest requestSqlExcept = mock(HttpServletRequest.class);
        HttpServletResponse responseSqlExcept = mock(HttpServletResponse.class);
        when(requestSqlExcept.getParameter("username")).thenReturn("-1");
        when(requestSqlExcept.getParameter("from")).thenReturn("1577836800");
        when(requestSqlExcept.getParameter("to")).thenReturn("1601849286");

        try {
            gd.doGet(requestSqlExcept, responseSqlExcept);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        verify(responseSqlExcept).sendError(500, null);

        // parse exception error
        HttpServletRequest requestParseExcept = mock(HttpServletRequest.class);
        HttpServletResponse responseParseExcept = mock(HttpServletResponse.class);
        when(requestParseExcept.getParameter("username")).thenReturn("two");
        when(requestParseExcept.getParameter("from")).thenReturn("1577836800");
        when(requestParseExcept.getParameter("to")).thenReturn("1601849286");

        try {
            gd.doGet(requestParseExcept, responseParseExcept);
        } catch (ServletException e) {
            e.printStackTrace();
            Assert.fail(e.getMessage());
            return;
        }
        verify(responseParseExcept).sendError(500, null);
    }
}
